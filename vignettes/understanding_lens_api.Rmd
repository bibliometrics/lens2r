---
title: "Understanding Lens.org API"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Understanding Lens.org API}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


```{r setup}
library(lens2r)
# Load dependencies
library(httr)
library(jsonlite)
```


# Usage

https://cran.r-project.org/web/packages/httr/vignettes/quickstart.html


```{r}
token <- Sys.getenv("LENS_TOKEN")

lens_get <- httr::GET(
  "https://api.lens.org/scholarly/usage",
  httr::add_headers(.headers =
                      c("Authorization" = token,
                        "Content-Type" = "application/json")
                    )
)

lens_get
# View(lens_get)
```




```{r}
lens_get[["url"]]
```


```{r}
lens_get[["status_code"]]
```


```{r}
lens_get[["headers"]]
```


```{r}
lens_get[["headers"]][["date"]]
```


```{r}
lens_get[["headers"]][["content-type"]]
```


```{r}
lens_get[["headers"]][["content-encoding"]]
```


```{r}
lens_get[["headers"]][["vary"]]
```


```{r}
lens_get[["all_headers"]]
```


```{r}
lens_get[["all_headers"]][[1]]
```


```{r}
lens_get[["all_headers"]][[1]][["status"]]
```


```{r}
lens_get[["all_headers"]][[1]][["version"]]
```


```{r}
lens_get[["all_headers"]][[1]][["headers"]]
```


```{r}
lens_get[["all_headers"]][[1]][["headers"]][["date"]]
```


```{r}
lens_get[["all_headers"]][[1]][["headers"]][["content-type"]]
```


```{r}
lens_get[["all_headers"]][[1]][["headers"]][["content-encoding"]]
```


```{r}
lens_get[["all_headers"]][[1]][["headers"]][["vary"]]
```


```{r}
lens_get[["cookies"]]
```


```{r}
lens_get[["cookies"]][["domain"]]
```


```{r}
lens_get[["cookies"]][["flag"]]
```


```{r}
lens_get[["cookies"]][["path"]]
```


```{r}
lens_get[["cookies"]][["secure"]]
```


```{r}
lens_get[["cookies"]][["expiration"]]
```


```{r}
lens_get[["cookies"]][["name"]]
```


```{r}
lens_get[["cookies"]][["value"]]
```


```{r}
lens_get[["content"]]
```


```{r}
lens_get[["date"]]
```


```{r}
lens_get[["times"]]
```


```{r}
lens_get[["times"]][["redirect"]]
```


```{r}
lens_get[["times"]][["namelookup"]]
```


```{r}
lens_get[["times"]][["connect"]]
```


```{r}
lens_get[["times"]][["pretransfer"]]
```


```{r}
lens_get[["times"]][["starttransfer"]]
```


```{r}
lens_get[["times"]][["total"]]
```


```{r}
lens_get[["request"]]
```


```{r}
lens_get[["request"]][["method"]]
```


```{r}
lens_get[["request"]][["url"]]
```



---


# Get Scholarly Data

## [Code Samples - R](https://docs.api.lens.org/samples.html#r)


```r
require(httr)
getScholarlyData <- function(token, query){
	url <- 'https://api.lens.org/scholarly/search'
	headers <- c('Authorization' = token, 'Content-Type' = 'application/json')
	httr::POST(url = url, add_headers(.headers=headers), body = query)
}
token <- 'your-access-token'
request <- '{
	"query": {
		"match_phrase": {
			"author.affiliation.name": "Harvard University"
		}
	},
	"size": 1,
	"sort": [{
		"year_published": "desc"
	}]
}'
data <- getScholarlyData(token, request)
content(data, "text")
```

## get_scholarly_data.R


---


# Get Collection Data


https://www.lens.org/lens/scholar/search/results?collectionId=170675



```{r get collection data}
token <- Sys.getenv("LENS_TOKEN")

collection_lens <- httr::GET(
  "https://api.lens.org/collections/170675",
  httr::add_headers(.headers =
                      c("Authorization" = token,
                        "Content-Type" = "application/json")
                    )
)
```


```{r View collection data}
collection_lens
# View(collection_lens)
```


```{r details of the collection data, eval=FALSE, include=FALSE}
collection_lens[["url"]]
collection_lens[["status_code"]]
collection_lens[["headers"]]
collection_lens[["headers"]][["date"]]
collection_lens[["headers"]][["content-type"]]
collection_lens[["headers"]][["x-rate-limit-reset-date"]]
collection_lens[["headers"]][["x-rate-limit-remaining-request-per-month"]]
collection_lens[["headers"]][["x-rate-limit-remaining-record-per-month"]]
collection_lens[["headers"]][["x-rate-limit-remaining-request-per-minute"]]
collection_lens[["headers"]][["x-result-time"]]
collection_lens[["headers"]][["content-encoding"]]
collection_lens[["headers"]][["vary"]]
collection_lens[["all_headers"]]
collection_lens[["all_headers"]][[1]]
collection_lens[["all_headers"]][[1]][["status"]]
collection_lens[["all_headers"]][[1]][["version"]]
collection_lens[["all_headers"]][[1]][["headers"]]
collection_lens[["all_headers"]][[1]][["headers"]][["date"]]
collection_lens[["all_headers"]][[1]][["headers"]][["content-type"]]
collection_lens[["all_headers"]][[1]][["headers"]][["x-rate-limit-reset-date"]]
collection_lens[["all_headers"]][[1]][["headers"]][["x-rate-limit-remaining-request-per-month"]]
collection_lens[["all_headers"]][[1]][["headers"]][["x-rate-limit-remaining-record-per-month"]]
collection_lens[["all_headers"]][[1]][["headers"]][["x-rate-limit-remaining-request-per-minute"]]
collection_lens[["all_headers"]][[1]][["headers"]][["x-result-time"]]
collection_lens[["all_headers"]][[1]][["headers"]][["content-encoding"]]
collection_lens[["all_headers"]][[1]][["headers"]][["vary"]]
collection_lens[["cookies"]]
collection_lens[["cookies"]][["domain"]]
collection_lens[["cookies"]][["flag"]]
collection_lens[["cookies"]][["path"]]
collection_lens[["cookies"]][["secure"]]
collection_lens[["cookies"]][["expiration"]]
collection_lens[["cookies"]][["name"]]
collection_lens[["cookies"]][["value"]]
collection_lens[["content"]]
collection_lens[["date"]]
collection_lens[["times"]]
collection_lens[["times"]][["redirect"]]
collection_lens[["times"]][["namelookup"]]
collection_lens[["times"]][["connect"]]
collection_lens[["times"]][["pretransfer"]]
collection_lens[["times"]][["starttransfer"]]
collection_lens[["times"]][["total"]]
collection_lens[["request"]]
collection_lens[["request"]][["method"]]
collection_lens[["request"]][["url"]]
collection_lens[["request"]][["headers"]]
collection_lens[["request"]][["headers"]][["Accept"]]
# collection_lens[["request"]][["headers"]][["Authorization"]]
collection_lens[["request"]][["headers"]][["Content-Type"]]
collection_lens[["request"]][["fields"]]
collection_lens[["request"]][["options"]]
collection_lens[["request"]][["options"]][["useragent"]]
collection_lens[["request"]][["options"]][["httpget"]]
collection_lens[["request"]][["auth_token"]]
collection_lens[["request"]][["output"]]
collection_lens[["handle"]]

```


```{r collection data to dataframe}
output_collection_lens <- httr::content(collection_lens, "text")

output_collection_flatten <- jsonlite::fromJSON(output_collection_lens,
                                     flatten = TRUE)

output_collection_flatten_data <- output_collection_flatten$data

output_collection_flatten_data

output_collection_flatten <- as.data.frame(output_collection_flatten)

output_collection_flatten
```


---

# [Examples](https://docs.api.lens.org/examples.html)


## Find 20 records from offset 10 that match provided query

{
  "query": "X-ray analysis of protein crystals",
  "size": 20,
  "from": 10
}

## Get the patent citations, scholarly citations and references for a list of scholarly works using the lens_id

{
  "query": {
    "terms":{
      "lens_id": ["017-767-306-508-482", "017-624-265-921-255"]
    }
  },
  "include": ["lens_id", "patent_citations", "scholarly_citations", "references"]
}

## Get title and patent citations for a scholarly work using a doi

{
  "query": {
    "match":{
      "doi": "10.1109/ee.1934.6540358"
    }
  },
  "include":["title","patent_citations"]
}

## Get scholarly works using multiple pmid

{
	"query": {
		"terms": {
			"pmid": ["14297189", "17475107"]
		}
	}
}

## Get the metadata for scholarly works that are cited by a list of patents using the patent lens_id

{
  "query": {
    "terms": {
      "patent_citation.lens_id":["198-832-374-467-397", "092-513-162-449-806"]
    }
  }
}

## Find the 10 most recently published works from an institution (sorted by published date)

{
  "query": {"match_phrase": {"author.affiliation.name": "Harvard University"}},
  "sort": [{"date_published": "desc"}],
  "size": 10
}

## Get publication year of journal articles cited by patents

{
   "query": {
       "bool" : {
        "must": [
            {"terms": { "patent_citation.lens_id": ["020-159-299-402-960", "014-680-767-794-441"]}},
            {"match": {"source.type": "Journal"}}
        ]
      }
   },
   "include": ["year_published"],
   "size": 50
}

## Get 30 works from an institution published between two years

{
  "query": {
    "bool": {
      "must": {"match_phrase": {"author.affiliation.name": "Harvard University"}},
    "filter": {
      "range": {
        "year_published": {
          "gte": "1999",
          "lte": "2000"
          }
        }
      }
    }
  },
  "size": 30
}

## Get scholarly works having patent citations and affiliations

{
    "query": {
        "bool":{
            "must": [
                {"match": {"has_patent_citations": true}},
                {"match": {"has_affiliation": true}}
            ]
        }
    }
}

## Query by author name

{
    "query": {
        "match_phrase": {"author.display_name": "Craig Venter"}
    },
    "sort": [{"year_published": "desc"}],
    "size": 10
}

## Find scholarly works with a Pubmed identifier published in 2012

{
    "query": {
        "bool":{
           "must":[
             {"match":{"external_id_type": "pmid"}},
             {"match":{"year_published": 2012}}
           ]
        }
    },
    "include":["patent_citations_count", "external_ids"]
}

## OR using String Based Query

{
    "query": "external_id_type: pmid AND year_published: 2012",
    "include":["patent_citations_count", "external_ids"]
}

## Access your collection

[POST] https://api.lens.org/collections/123456

    {
      "query": {"match": {"title": "Malaria"}},
      "include":["title","lens_id", "authors.first_name"],
      "size":10
    }

# Using GET Requests

    [GET] https://api.lens.org/collections/123456?token=[your-access-token]&size=10&query=Malaria&include=authors,lens_id&sort=desc(date_published)

    [GET] https://api.lens.org/scholarly/search?token=[your-access-token]&size=10&query=Malaria&include=authors,lens_id&sort=desc(date_published)





















---

# [API Endpoints](https://docs.api.lens.org/getting-started.html#api-endpoints)


```
Scholarly Works:

[POST] https://api.lens.org/scholarly/search
[GET] https://api.lens.org/scholarly/search
Collections:

[POST] https://api.lens.org/collections/{collection_id}
[GET] https://api.lens.org/collections/{collection_id}

```










---









